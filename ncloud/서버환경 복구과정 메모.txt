
1. Minikube compvalue í´ëŸ¬ìŠ¤í„° ë¨¸ì‹ ëŸ¬ë‹ íŒŒë“œ(comp-value-ml) ì¶”ê°€ í›„ í•™ìŠµí• ë•Œ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ë…¸ë“œê°€ ì£½ìŒ
2. ë©”ëª¨ë¦¬ ëŠ˜ë ¤ì•¼í•˜ëŠ” ìƒí™©ì´ë¼ ê¸°ì¡´ í´ëŸ¬ìŠ¤í„° ì§€ìš°ê³  ë‹¤ì‹œ ìƒì„±í•´ì•¼í•´ì„œ ë°ì´í„° ë³µêµ¬, ì„¤ì • ë³µêµ¬ ë“± í• ê²Œ ë§ì•˜ìŒ


 minikube (compvalue í”„ë¡œíŒŒì¼) ë©”ëª¨ë¦¬ ì¦ê°€ ì „ì²´ ì ˆì°¨ (ì°¸ê³ ) ================================================

  ì‚¬ì „ ì¤€ë¹„: í˜„ì¬ í”„ë¡œíŒŒì¼ í™•ì¸

  # í”„ë¡œíŒŒì¼ ëª©ë¡ í™•ì¸
  minikube profile list

  # compvalue í”„ë¡œíŒŒì¼ í™œì„±í™”
  minikube profile compvalue

  # ë˜ëŠ” ëª¨ë“  ëª…ë ¹ì— -p compvalue ì˜µì…˜ ì¶”ê°€

  1ë‹¨ê³„: ë°±ì—… (í•„ìˆ˜, 15ë¶„)

  # 1. models í´ë” ë°±ì—… (PVC ë°ì´í„°)
  kubectl exec -it deployment/stock-predictor -n default -- tar czf /tmp/models-backup.tar.gz /app/models

  # Pod ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
  POD_NAME=$(kubectl get pod -l app=stock-predictor -n default -o jsonpath='{.items[0].metadata.name}')

  # ë¡œì»¬ë¡œ ë³µì‚¬
  kubectl cp default/${POD_NAME}:/tmp/models-backup.tar.gz ./models-backup.tar.gz

  # ë°±ì—… íŒŒì¼ í™•ì¸
  ls -lh ./models-backup.tar.gz

  # 2. Secret ë°±ì—…
  kubectl get secret api-key-secret -n default -o yaml > api-key-secret-backup.yaml
  kubectl get secret ghcr-secret -n default -o yaml > ghcr-secret-backup.yaml

  # 3. PVC ì •ë³´ ë°±ì—…
  kubectl get pvc -n default -o yaml > pvc-backup.yaml

  # 4. Deployment ë°±ì—… (gitì— ìˆì§€ë§Œ ì•ˆì „í•˜ê²Œ)
  kubectl get deployment stock-predictor -n default -o yaml > deployment-backup.yaml

  # 5. PostgreSQL, Redis ë“± ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ í™•ì¸
  kubectl get all -n default
  kubectl get pvc -n default
  kubectl get secret -n default

  # 6. PostgreSQL ë°ì´í„° ë°±ì—… (ì„ íƒì‚¬í•­, ì¤‘ìš” ë°ì´í„°ë¼ë©´)
  kubectl exec -it deployment/postgres -n default -- pg_dump -U compvalue COMP_VALUE > db-backup.sql

  2ë‹¨ê³„: í¬íŠ¸í¬ì›Œë”© ì¢…ë£Œ

  # ì‹¤í–‰ ì¤‘ì¸ port-forward í”„ë¡œì„¸ìŠ¤ í™•ì¸
  ps aux | grep "port-forward"

  # ëª¨ë“  port-forward ì¢…ë£Œ
  pkill -f "kubectl port-forward"

  # í™•ì¸
  ps aux | grep "port-forward"  # ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì™€ì•¼ í•¨

  3ë‹¨ê³„: minikube ì‚­ì œ ë° ì¬ìƒì„± (10ë¶„)

  # compvalue í”„ë¡œíŒŒì¼ ì¤‘ì§€
  minikube -p compvalue stop

  # compvalue í”„ë¡œíŒŒì¼ ì‚­ì œ (âš ï¸ ì´ ë‹¨ê³„ì—ì„œ ëª¨ë“  ë°ì´í„° ì‚­ì œë¨)
  minikube -p compvalue delete

  # ì‚­ì œ í™•ì¸
  minikube profile list
  # compvalueê°€ ëª©ë¡ì—ì„œ ì‚¬ë¼ì ¸ì•¼ í•¨

  # compvalue í”„ë¡œíŒŒì¼ë¡œ ìƒˆë¡œ ì‹œì‘ (ë©”ëª¨ë¦¬ 12GB, CPU 6, ë””ìŠ¤í¬ 40GB)
  minikube start -p compvalue --memory=12288 --cpus=6 --disk-size=40g --driver=docker

  # ì‹œì‘ ì™„ë£Œê¹Œì§€ 2-3ë¶„ ì†Œìš”
  # ì¶œë ¥:
  # ğŸ„  Done! kubectl is now configured to use "compvalue" cluster and "default" namespace by default

  4ë‹¨ê³„: í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸

  # í”„ë¡œíŒŒì¼ ì„¤ì •
  minikube profile compvalue

  # ë…¸ë“œ í™•ì¸
  kubectl get nodes
  # STATUS: Ready í™•ì¸

  # ë©”ëª¨ë¦¬ í™•ì¸
  minikube -p compvalue ssh
  free -h
  # ì¶œë ¥ ì˜ˆìƒ:
  # Mem: 11.7Gi (12GB í• ë‹¹ë¨)
  # Swap: 1.0Gi
  exit

  # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸
  kubectl get ns
  # defaultê°€ ìˆì–´ì•¼ í•¨ (ìë™ ìƒì„±ë¨)

  5ë‹¨ê³„: PVC ì¬ìƒì„± (5ë¶„)

  # PVC ìƒì„±
  kubectl apply -f k8s/pvc.yaml

  # ìƒíƒœ í™•ì¸ (Bound ë  ë•Œê¹Œì§€ ëŒ€ê¸°)
  kubectl get pvc -n default
  # ì¶œë ¥:
  # NAME                           STATUS   VOLUME   CAPACITY
  # stock-predictor-models-pvc     Bound    pvc-xxx  10Gi
  # stock-predictor-logs-pvc       Bound    pvc-xxx  5Gi

  # Bound ì•ˆ ë˜ë©´ ì ì‹œ ëŒ€ê¸° í›„ ë‹¤ì‹œ í™•ì¸
  watch kubectl get pvc -n default

  6ë‹¨ê³„: Secret ì¬ìƒì„± (2ë¶„)

  # ë°©ë²• 1: ë°±ì—…ì—ì„œ ë³µêµ¬ (UUID ë“±ì´ ë³€ê²½ë˜ì–´ ì•ˆ ë  ìˆ˜ ìˆìŒ)
  # kubectl apply -f api-key-secret-backup.yaml
  # kubectl apply -f ghcr-secret-backup.yaml

  # ë°©ë²• 2: ìƒˆë¡œ ìƒì„± (ê¶Œì¥)
    => ìƒˆë¡œìƒì„±í• ë•Œ yaml ë°±ì—…í•œê±°ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ë©´ base64 í•œë²ˆ ë” í’€ì–´ì¤˜ì•¼í•¨, ì´ì™•ì´ë©´ ì›ë³¸ìœ¼ë¡œ ë“±ë¡í•˜ëŠ”ê±° ê¶Œì¥
  # FMP API Key Secret
  kubectl create secret generic api-key-secret \
    --from-literal=FMP_API_KEY=<YOUR_FMP_API_KEY> \
    -n default

  # GitHub Container Registry Secret
  kubectl create secret docker-registry ghcr-secret \
    --docker-server=ghcr.io \
    --docker-username=gnsgmlckdgk \
    --docker-password=<YOUR_GITHUB_PAT> \
    --docker-email=gnsgmlckdgk@users.noreply.github.com \
    -n default

  # í™•ì¸
  kubectl get secret -n default

  7ë‹¨ê³„: PostgreSQL & Redis ì¬ë°°í¬ (í•„ìš” ì‹œ)

  # PostgreSQL ìˆëŠ”ì§€ í™•ì¸
  kubectl get deployment postgres -n default

  # ì—†ë‹¤ë©´ ë°°í¬ (YAML íŒŒì¼ì´ ìˆë‹¤ê³  ê°€ì •)
  # kubectl apply -f k8s/postgres.yaml

  # Redis í™•ì¸
  kubectl get deployment redis -n default

  # ì—†ë‹¤ë©´ ë°°í¬
  # kubectl apply -f k8s/redis.yaml

  # ì„œë¹„ìŠ¤ í™•ì¸
  kubectl get svc -n default
  # postgres-service, redis-nodeport í™•ì¸

  8ë‹¨ê³„: stock-predictor Deployment ë°°í¬ (5ë¶„)

  # Deployment ë°°í¬
  kubectl apply -f k8s/deployment.yaml

  # Pod ìƒì„± í™•ì¸
  kubectl get pods -n default
  # stock-predictor-xxxê°€ Running ë  ë•Œê¹Œì§€ ëŒ€ê¸°

  # ì‹¤ì‹œê°„ í™•ì¸
  watch kubectl get pods -n default

  # ë¡œê·¸ í™•ì¸
  kubectl logs -f deployment/stock-predictor -n default

  9ë‹¨ê³„: models ë°ì´í„° ë³µêµ¬ (5ë¶„)

  # Pod ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
  POD_NAME=$(kubectl get pod -l app=stock-predictor -n default -o jsonpath='{.items[0].metadata.name}')

  # ë°±ì—… íŒŒì¼ ë³µì‚¬
  kubectl cp ./models-backup.tar.gz default/${POD_NAME}:/tmp/

  # Pod ì ‘ì†í•˜ì—¬ ì••ì¶• í•´ì œ
  kubectl exec -it deployment/stock-predictor -n default -- bash

  # Pod ë‚´ë¶€ì—ì„œ ì‹¤í–‰:
  cd /app
  tar xzf /tmp/models-backup.tar.gz --strip-components=2
  ls -la models/
  # ëª¨ë¸ íŒŒì¼ë“¤ì´ ë³µêµ¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
  exit

  # ë˜ëŠ” í•œ ì¤„ë¡œ:
  kubectl exec -it deployment/stock-predictor -n default -- tar xzf /tmp/models-backup.tar.gz -C /app --strip-components=2

  # í™•ì¸
  kubectl exec -it deployment/stock-predictor -n default -- ls -la /app/models/

  10ë‹¨ê³„: í¬íŠ¸í¬ì›Œë”© ì¬ì„¤ì • (1ë¶„)

  # PostgreSQL í¬íŠ¸í¬ì›Œë”©
  kubectl port-forward svc/postgres-service 5433:5432 -n default &

  # Redis í¬íŠ¸í¬ì›Œë”© (í•„ìš” ì‹œ)
  kubectl port-forward svc/redis-nodeport 6380:6379 -n default &

  # í™•ì¸
  ps aux | grep "port-forward"

  11ë‹¨ê³„: PostgreSQL ë°ì´í„° ë³µêµ¬ (ì„ íƒì‚¬í•­)

  # ë°±ì—…í–ˆë‹¤ë©´ ë³µêµ¬
  kubectl cp ./db-backup.sql default/$(kubectl get pod -l app=postgres -n default -o jsonpath='{.items[0].metadata.name}'):/tmp/

  kubectl exec -it deployment/postgres -n default -- psql -U compvalue -d COMP_VALUE -f /tmp/db-backup.sql

  12ë‹¨ê³„: ìµœì¢… í™•ì¸ (5ë¶„)

  # 1. ë©”ëª¨ë¦¬ í™•ì¸
  minikube -p compvalue ssh
  free -h
  # Mem: 11.7Gi í™•ì¸
  exit

  # 2. ëª¨ë“  ë¦¬ì†ŒìŠ¤ í™•ì¸
  kubectl get all -n default
  kubectl get pvc -n default
  kubectl get secret -n default

  # 3. Pod ìƒíƒœ í™•ì¸
  kubectl describe pod -l app=stock-predictor -n default
  # Eventsì— ì—ëŸ¬ê°€ ì—†ëŠ”ì§€ í™•ì¸

  # 4. ë¡œê·¸ í™•ì¸
  kubectl logs -f deployment/stock-predictor -n default

  # 5. ì—°ê²° í…ŒìŠ¤íŠ¸ (ë¡œì»¬)
  cd /Users/hch/Files/Dev/project/comp-value-ml
  source venv/bin/activate
  python test_local.py --test-connection

  # 6. ëª¨ë¸ íŒŒì¼ í™•ì¸
  kubectl exec -it deployment/stock-predictor -n default -- ls -la /app/models/ | head -20

===================================================================
DB ë°ì´í„° ë³µêµ¬
- ncloud/backend/db/BACKUP_README.md ì°¸ê³ 

ì°¸ê³ ì‚¬í•­
1. Gitlab ì—ì„œ ë³µêµ¬ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ~.gpg

2. - BACKUP_PASSPHRASE ê°’ í™•ì¸ í•„ìš” (ë°±ì—… ë°ì´í„° ë³µí˜¸í™”ì‹œ í•„ìš”)
    - kubectl get secret [postgres-backup] -o yaml ì—ì„œ BACKUP_PASSPHRASE ê²€ìƒ‰
    - ê°’ í™•ì¸í›„ base64 ë””ì½”ë”© => 2ë²ˆ ì¸ì½”ë”© ë˜ì–´ìˆì–´ì„œ 2ë²ˆ ë””ì½”ë”© í–ˆìŒ

3. gpg --decrypt --batch --passphrase "your-backup-passphrase" \
   postgres_backup_20250104_030000.sql.gpg > restore.sql
   => gpg ëª…ë ¹ì–´ ì—†ìœ¼ë©´ ì„¤ì¹˜í•˜ë©´ ë¨

4. ë°±ë‹¨ ì•± ì‹¤í–‰í•´ì„œ í…Œì´ë¸” ìƒì„±ë˜ì–´ìˆìœ¼ë©´ í…Œì´ë¸” ì „ë¶€ ì‚­ì œ í›„ ì§„í–‰
   => í…Œì´ë¸” ë³µêµ¬, ì‹œí€€ìŠ¤ ë³µêµ¬, ë°ì´í„° ë³µêµ¬ ë“±ë“± í•œë²ˆì— ë¨
   => psql ì´ë¼ sql íˆ´ì—ì„œëŠ” ì•ˆë˜ê³  pod ì— ë³µì‚¬í•´ì„œ BACKUP_README.me ì— ìˆëŠ” ì ˆì°¨ëŒ€ë¡œ ì§„í–‰í•˜ë©´ ë¨

5. secret yaml ë¡œ ë½‘ì€ ê°’ì€ base64 ë˜ì„œ ì¶œë ¥ë˜ì„œ í•œë²ˆ í’€ì–´ì£¼ê³  ì¬ë“±ë¡ í•´ì•¼í•¨

=> ì´í›„ ì ˆì°¨ëŠ” BACKUP_README.md ì°¸ê³ í•´ì„œ ì§„í–‰
